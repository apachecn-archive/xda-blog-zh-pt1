# Dart 2.12 已经发布，具有空安全和 C 互操作性

> 原文：<https://www.xda-developers.com/dart-2-12-release/>

随着 Flutter 2.0 的[发布，谷歌也将 Dart 2.12 带入稳定。如果你不知道，Dart 是 Flutter 使用的语言。这是一种基于类型脚本的语言，但是增加了一些语言特性，包括我将要介绍的那些。](https://www.xda-developers.com/flutter-2-0-web-stable)

## 零安全

空安全是一个非常好的语言特性。它迫使您考虑一个变量是否会为空，并明确地处理潜在的空情况，同时也让您保证特定的变量永远不会为空。

在 Dart 2.12 中，现在完全支持空安全，语法类似于 Swift 和 Kotlin。甚至还有智能转换，如果 Dart 确实知道一个通常可为空的变量不能为空，它会隐式地将其转换为不可为空的形式。

因为零安全是一个(非常)突破性的改变，这个特性是选择加入的。如果你更新到 Dart 2.12，你的编译不会中断，你也不用花几个小时给所有东西添加可空性提示。如果您的项目还不是空安全的，您甚至可以使用空安全依赖项。

一旦您决定迁移，您可以使用内置的迁移工具( **dart migrate** )和/或[迁移指南](https://dart.dev/null-safety/migration-guide)来设置一切。

此外，虽然空安全包含在 Dart 2.12 中，但是如果您创建一个新的 Flutter 项目，空安全将不会被开箱即用。您需要手动启用它。新的 Dart 项目将启用空安全。

## 外部功能接口

尽管 Dart(和 Flutter)的重点是完全的跨平台兼容性，但仍有一些事情需要在本地完成。为了使本机操作更容易，Dart 有一个外部函数接口，即 FFI。FFI 允许您与 Dart 中的 C 代码进行交互，而不必求助于奇怪的基于字符串的 API 调用或其他笨拙的互操作性方法。

有了 Dart 2.12，FFI 现在稳定了，这意味着它可以用于生产项目，并且大部分功能都已完成。

考虑到这一点，FFI 有一些变化，包括一些突破性的变化。

此版本的主要关注点是如何将结构与 Dart 和 C 一起使用。首先，您现在可以通过引用和值来传递 C 代码中的结构，而以前只支持引用。另一个重要的特性是对嵌套结构的支持，这在这个版本之前是没有的。

现在是突破性的变化。如果您使用的是 FFI，那么您可能需要更新您的代码来使用 2.12。使用这个版本的 FFI，您不能再创建空结构。如果你因为某种原因需要一个，你可以使用新的“不透明”类型。对 FFI 的一些内置函数的工作方式也有一些改变，你可以[在这里](https://github.com/dart-lang/sdk/issues/44621)读到。

最后，FFI 有了一个新的包，可以让你从现有的 C 头文件生成 FFI 包装器，叫做 [ffigen](https://pub.dev/packages/ffigen) 。如果你有很多 C 代码需要使用，有很多 API 方法，这将是非常有用的。即使您拥有的 C 代码数量很少，这也是一个很好的便利特性。

* * *

这就是 Dart 2.12 的大部分内容。随着 null-safety 和稳定的 C 互用性库的加入，Dart 正在变成一种功能非常丰富的语言。请在评论中告诉我们你对 Dart 2.12 的看法！