<html>
<head>
<title>How to add View Binding to an Android Gradle project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在 Android Gradle 项目中添加视图绑定</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/android-add-view-binding/#0001-01-01">https://www.xda-developers.com/android-add-view-binding/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>大多数 Android 开发人员可能都熟悉经典的<code>findViewById()</code>方法。将 XML 布局中的一个视图的 ID 传递给它，它将返回对该视图的放大版本的引用。这都是假设您传递了正确的 ID，并且视图确实存在。<code>findViewById()</code>没有内置检查来防止您试图检索您无法检索的视图。输入视图绑定。</p>

  
<p/><p>视图绑定自动为每个布局 XML 生成一个绑定类，而不是在每个视图上使用<code>findViewById()</code>。每个带有 ID 的视图都会自动添加到类中，因此您可以直接引用它们。</p>

<p>向 Android Gradle 项目添加视图绑定非常简单。</p>

 
<h2 id="gradle-setup">Gradle Setup</h2>
<p>在 Gradle 中，视图绑定是在模块级别启用的。如果您有多个模块，您需要为每个模块单独启用它。</p>

<p>在模块级<code>build.gradle</code>的<code>android</code>块中，添加启用视图绑定的选项。</p>

<pre> <code class="hljs javascript">android {<br/>    ...<br/><br/>    buildFeatures {<br/>        viewBinding <span class="hljs-literal">true</span><br/>    }<br/>}</code> </pre>
<p>可能会有一个关于非法访问的警告，但那是一个 lint bug，可以安全地忽略。</p>

<p>将启用同步项目和视图绑定。就这么简单。</p>
<p class="ad-odd"> </p>


<h2 id="using-view-binding">使用视图绑定</h2>
<p>使用视图绑定有几种方法，但是在这之前，让我们先讨论一下绑定类是如何生成的。</p>

<h3 id="class-name-syntax">类名语法</h3>
<p>假设您有一个名为<code>some_layout.xml</code>的布局 XML。其对应的绑定类将被命名为<code>SomeLayoutBinding</code>。这种模式适用于所有文件。</p>

<p>每个单词(文件名中用下划线分隔)都将大写，下划线将被删除。“绑定”然后被添加到末尾。</p>

<h3 id="instantiating-with-existing-view">用现有视图实例化</h3>
<p>如果您已经扩展了布局文件，并且有了对布局根的引用，那么您可以告诉视图绑定类使用现有的布局。</p>

<p><strong>锅炉</strong>:</p>

<pre> <code class="hljs javascript">val binding = SomeLayoutBinding.bind(someLayoutRoot )</code> </pre>
<p><strong> Java </strong>:</p>

<pre> <code class="hljs javascript">SomeLayoutBinding binding = SomeLayoutBinding.bind(someLayoutRoot );</code> </pre>
<p>例如，如果您想在一个片段中使用 binding 类，它看起来就像这样。</p>

<p><strong>锅炉</strong>:</p>

<pre> <code class="hljs bash"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeFragment</span> :</span> Fragment(R.layout.some_layout) {<br/>    <br/>    <span class="hljs-keyword">private</span> val binding by lazy { SomeLayoutBinding.bind(view) }<br/><br/>    <span class="hljs-function">override fun <span class="hljs-title">onViewCreated</span><span class="hljs-params">(view: View, savedInstanceState: Bundle?)</span> </span>{<br/>        <span class="hljs-keyword">super</span>.onViewCreated(view, savedInstanceState)<br/>        <br/>        <br/>    }<br/>}</code> </pre>
<p><strong> Java </strong>:</p>

<pre> <code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeFragment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Fragment</span> </span>{<br/>    <span class="hljs-keyword">private</span> SomeLayoutBinding binding = <span class="hljs-keyword">null</span>;<br/><br/>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SomeFragment</span><span class="hljs-params">()</span> </span>{<br/>        <span class="hljs-selector-tag">super</span>(<span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.layout</span><span class="hljs-selector-class">.some_layout</span>);<br/>    }<br/><br/>    <span class="hljs-meta">@Override</span><br/>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onViewCreated</span><span class="hljs-params">(View view, Bundle savedInstanceState)</span> </span>{<br/>        <span class="hljs-keyword">super</span>.onViewCreated(view, savedInstanceState);<br/>   <br/>        <br/>        binding = SomeLayoutBinding.bind(view);<br/>    }<br/>}</code> </pre>
<h3 id="instantiating-with-new-view">用新视图实例化</h3>
<p>binding 类也可以为您放大布局。</p>

<p><strong>锅炉</strong>:</p>

<pre> <code class="hljs javascript">val binding = SomeLayoutBinding.inflate(layoutInflater )</code> </pre>
<p><strong> Java </strong>:</p>

<pre> <code class="hljs javascript">SomeLayoutBinding binding = SomeLayoutBinding.inflate(layoutInflater );</code> </pre>
<p>这个方法在片段和活动中都有用。</p>

<p>一个<strong>示例片段</strong>看起来像下面这样。</p>

<p><strong>锅炉</strong>:</p>

<pre> <code class="hljs bash"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeFragment</span> :</span> Fragment() {<br/>    <span class="hljs-keyword">private</span> val binding by lazy { SomeLayoutBinding.inflate(LayoutInflater.from(requireContext())) }<br/><br/>    <span class="hljs-function">override fun <span class="hljs-title">onCreateView</span><span class="hljs-params">(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?)</span> </span>{<br/>        <br/>        <span class="hljs-keyword">return</span> binding.root<br/>    }<br/>}</code> </pre>
<p><strong> Java </strong>:</p>

<pre> <code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeFragment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Fragment</span> </span>{<br/>    <span class="hljs-keyword">private</span> SomeLayoutBinding binding = <span class="hljs-keyword">null</span>;<br/><br/>    <span class="hljs-meta">@Override</span><br/>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>{<br/>        <br/>        binding = SomeLayoutBinding.inflate(inflater);<br/>        <br/>        <span class="hljs-keyword">return</span> binding.getRoot();<br/>    }<br/>}</code> </pre>
<p>一个<strong>示例活动</strong>如下所示。</p>

<p><strong>锅炉</strong>:</p>

<pre> <code class="hljs bash"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeActivity</span> :</span> AppCompatActivity() {<br/>    <span class="hljs-keyword">private</span> val binding by lazy { SomeLayoutBinding.inflate(layoutInflater) }<br/><br/>    <span class="hljs-function">override fun <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: Bundle?)</span> </span>{<br/>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br/><br/>        <br/>        <span class="hljs-selector-tag">setContentView</span>(<span class="hljs-selector-tag">binding</span><span class="hljs-selector-class">.root</span>)<br/>    }<br/>}</code> </pre>
<p><strong> Java </strong>:</p>

<pre> <code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>{<br/>    <span class="hljs-keyword">private</span> SomeLayoutBinding binding = <span class="hljs-keyword">null</span>;<br/><br/>    <span class="hljs-meta">@Override</span><br/>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{<br/>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<br/><br/>        <br/>        binding = SomeLayoutBinding.inflate(getLayoutInflater());<br/>        <br/>        <span class="hljs-selector-tag">setContentView</span>(<span class="hljs-selector-tag">binding</span><span class="hljs-selector-class">.getRoot</span>());<br/>    }<br/>}</code> </pre>
<h3 id="referencing-views">参考视图</h3>
<p>既然视图绑定类已经设置好并可以使用了，是时候实际使用它了。</p>

<p>假设<code>some_layout.xml</code>的内容如下:</p>

<pre> <code class="hljs xml">&lt;LinearLayout<br/>    android:<br/>    ...&gt;<br/>    &lt;FrameLayout<br/>        android:<br/>        ...<br/>        /&gt;<br/>    &lt;ImageView<br/>        android:<br/>        ...<br/>        /&gt;<br/>    &lt;LinearLayout<br/>        android:<br/>        ...&gt;<br/>        &lt;ImageView<br/>            android:<br/>            ...<br/>            /&gt;<br/>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br/><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span></code> </pre>
<p>代码中有很多 id 可以引用。但是只要实例化了绑定类，引用就很容易了。</p>

<p>在 Kotlin 中，视图由匹配其 id 的变量引用，只是有些变化。下划线被删除，产生的字符串是驼峰式大小写。例如，要从代码中引用<code>some_frame_layout</code>，您可以使用<code>binding.someFrameLayout</code>。<code>someFrameLayout</code>变量将是 FrameLayout 的一个实例。</p>

<pre> <code class="hljs ">val someFrameLayout: FrameLayout = binding.someFrameLayout</code> </pre>
<p>在 Java 中，视图由匹配其 id 的 getter 方法引用，格式类似于 Kotlin。例如，要引用<code>some_frame_layout</code>，你可以使用<code>binding.getSomeFrameLayout()</code>。该方法将返回 FrameLayout 的一个实例。</p>

<pre> <code class="hljs ">FrameLayout someFrameLayout = binding.getSomeFrameLayout();</code> </pre>
<p>视图引用在绑定中也被展平。引用<code>inner_imageview</code>与引用<code>some_frame_layout</code>相同。</p>
<p class="ad-even"> </p>


<h2 id="conclusion">结论</h2>
<p>我相信你可以看到，Android 中的视图绑定既容易实现又容易使用。很多时候比<code>findViewById()</code>好用。</p>

<p>关于实现视图绑定的更多细节，以及一些例子，<a href="https://developer.android.com/topic/libraries/view-binding">查看 Google 的官方文档</a>。</p>

 </div>


</div>    
</body>
</html>